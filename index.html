<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smooth Overlay Pause Endless</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  overflow: hidden;
  font-family: Arial, sans-serif;
}

#tunnel-background {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border: none;
  z-index: 0;
}

#overlay-system {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 10;
  touch-action: none;
  transition: transform 0.6s cubic-bezier(0.25, 0.1, 0.25, 1);
  transform: translateX(0);
}

#overlay-system.paused {
  transform: translateX(60%);
}

.page {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  transform-origin: center center;
  transition: transform 0.6s ease, opacity 0.6s ease;
  opacity: 0;
  transform: scale(0);
  z-index: 1;
}

.title {
  position: absolute;
  top: 20px;
  left: 20px;
  color: #ccc;
  font-size: 2rem;
  text-shadow: 1px 1px 5px black;
  z-index: 10;
  transition: opacity 0.6s ease;
}

.iframe-container {
  position: relative;
  width: 100vw;
  height: 100vh;
  transition: transform 0.6s ease, opacity 0.6s ease;
  transform-origin: center center;
  transform: scale(0.6);
}

.iframe-container.active {
  transform: scale(1.2);
  z-index: 999;
}

.iframe-container iframe {
  width: 100%;
  height: 100%;
  border: none;
  pointer-events: none;
  filter: blur(5px);
  transition: filter 0.6s ease;
}

.iframe-container.active iframe {
  pointer-events: auto;
  filter: blur(0);
}

.click-overlay {
  position: absolute;
  inset: 0;
  cursor: grab;
  z-index: 20;
  transition: opacity 0.6s ease;
}

.click-overlay.hidden-overlay {
  opacity: 0;
  pointer-events: none;
}
</style>
</head>
<body>

<iframe id="tunnel-background" src="https://paulkimmerl.github.io/tunnel/"></iframe>

<div id="overlay-system"></div>

<script>
const overlaySystem = document.getElementById("overlay-system");

// ==== Seiten aus context.txt / GitHub ====
const originalPagesData = [
  {title: "Portfolio Projekt Showcase", src: "https://paulkimmerl.github.io/", description: "Schau dir meine Projekte an."},
  {title: "Test Seite", src: "https://paulkimmerl.github.io/s/", description: "Tatata Testseite."},
  {title: "Webbasierter OBJ-Viewer", src: "https://paulkimmerl.github.io/objviewer1/", description: "3D-Modelle direkt im Browser ansehen."},
  {title: "Intermediate Video Collection", src: "https://www.liovast.com/umkrempler", description: "Videos für Fortgeschrittene."}
];

let pages = [];
let currentPage = 0;

// ==== Funktion um Page zu erstellen ====
function createPage(data) {
  const page = document.createElement("div");
  page.classList.add("page");

  if(data.src) {
    const container = document.createElement("div");
    container.classList.add("iframe-container");

    const iframe = document.createElement("iframe");
    iframe.src = data.src;

    const overlay = document.createElement("div");
    overlay.classList.add("click-overlay");

    const title = document.createElement("div");
    title.classList.add("title");
    title.textContent = data.title;

    container.appendChild(iframe);
    container.appendChild(overlay);
    container.appendChild(title);
    page.appendChild(container);

    // Click Overlay
    overlay.addEventListener("click", e => {
      e.stopPropagation();
      if(overlaySystem.classList.contains("paused")) return;

      document.querySelectorAll(".iframe-container").forEach(c=>{
        c.classList.remove("active");
        c.querySelector(".click-overlay").classList.remove("hidden-overlay");
        c.querySelector("iframe").style.pointerEvents = "none";
        const t = c.querySelector(".title");
        if(t) t.style.opacity = 1;
      });

      container.classList.add("active");
      overlay.classList.add("hidden-overlay");
      iframe.style.pointerEvents = "auto";
      title.style.opacity = 0;
    });

    document.addEventListener("click", e => {
      if(overlaySystem.classList.contains("paused")) return;
      if(!container.contains(e.target)){
        container.classList.remove("active");
        overlay.classList.remove("hidden-overlay");
        iframe.style.pointerEvents = "none";
        title.style.opacity = 1;
      }
    });
  } else {
    const title = document.createElement("div");
    title.classList.add("title");
    title.textContent = data.title;
    page.appendChild(title);
  }

  overlaySystem.appendChild(page);
  return page;
}

// ==== Alle Originalseiten erstellen ====
originalPagesData.forEach(d=>{
  const p = createPage(d);
  pages.push(p);
});

// ==== Layout/Animation ====
function showPage(index) {
  pages.forEach((page,i)=>{
    if(i === index){
      page.style.transform = `scale(0.6)`;
      page.style.opacity = 1;
      page.style.zIndex = 100;
    } else if(i < index){
      page.style.transform = `scale(1.2)`;
      page.style.opacity = 0;
      page.style.zIndex = 50;
    } else {
      page.style.transform = `scale(0)`;
      page.style.opacity = 0;
      page.style.zIndex = 0;
    }
  });
}

showPage(currentPage);

// ==== Endless Loop: neue Fake-Seiten erzeugen ====
function ensureNextPage() {
  if(currentPage >= pages.length - 2){
    originalPagesData.forEach(d=>{
      const p = createPage(d);
      pages.push(p);
    });
  }
}

// ==== Scroll / Wheel ====
window.addEventListener('wheel', e=>{
  if(overlaySystem.classList.contains("paused")) return;
  if(e.deltaY > 0) currentPage++;
  else if(e.deltaY < 0 && currentPage>0) currentPage--;
  ensureNextPage();
  showPage(currentPage);
});

// ==== Touch Scroll ====
let touchStartY = 0;
window.addEventListener('touchstart', e => touchStartY = e.touches[0].clientY);
window.addEventListener('touchend', e => {
  if(overlaySystem.classList.contains("paused")) return;
  let touchEndY = e.changedTouches[0].clientY;
  if(touchStartY > touchEndY + 10) currentPage++;
  else if(touchStartY < touchEndY - 10 && currentPage>0) currentPage--;
  ensureNextPage();
  showPage(currentPage);
});

// ==== Drag Overlay ====
let startX = 0, currentX = 0, dragging = false;
overlaySystem.addEventListener("mousedown", startDrag);
overlaySystem.addEventListener("touchstart", startDrag);
window.addEventListener("mousemove", moveDrag);
overlaySystem.addEventListener("touchmove", moveDrag);
window.addEventListener("mouseup", endDrag);
overlaySystem.addEventListener("touchend", endDrag);

function startDrag(e){
  if(!e.target.classList.contains("click-overlay")) return;
  dragging = true;
  startX = e.clientX || e.touches[0].clientX;
  overlaySystem.style.transition = "none";
}
function moveDrag(e){
  if(!dragging) return;
  currentX = (e.clientX || e.touches[0].clientX) - startX;
  if(currentX > 0) overlaySystem.style.transform = `translateX(${currentX}px)`;
}
function endDrag(){
  if(!dragging) return;
  dragging = false;
  overlaySystem.style.transition = "transform 0.6s cubic-bezier(0.25, 0.1, 0.25, 1)";
  if(currentX > window.innerWidth/3){
    overlaySystem.classList.add("paused");
    document.querySelectorAll(".iframe-container").forEach(c=>c.querySelector("iframe").style.pointerEvents = "none");
  } else {
    overlaySystem.classList.remove("paused");
    document.querySelectorAll(".iframe-container").forEach(c=>{
      c.querySelector("iframe").style.pointerEvents = c.classList.contains("active") ? 'auto' : 'none';
    });
  }
  overlaySystem.style.transform = "";
}

// ==== Klick Overlay zurück ====
overlaySystem.addEventListener('click', e=>{
  if(overlaySystem.classList.contains('paused')){
    overlaySystem.classList.remove('paused');
    document.querySelectorAll(".iframe-container").forEach(c=>{
      c.querySelector("iframe").style.pointerEvents = c.classList.contains("active") ? 'auto' : 'none';
    });
    e.stopPropagation();
  }
});
</script>

</body>
</html>
