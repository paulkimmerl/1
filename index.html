<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>TB Layout mit interaktivem Hintergrund</title>
<style>
html, body {
    margin:0;
    padding:0;
    width:100vw;
    height:100vh;
    font-family:sans-serif;
    font-weight:300;
    color:rgba(255,255,255,0.7);
    box-sizing:border-box;
    overflow-x:hidden;
    scroll-snap-type:y mandatory;
    scroll-behavior:smooth;
    background:black;
}
body{overflow-y:hidden;} /* Seite standardmäßig blockiert */

/* Hintergrund iFrame interaktiv */
#bg-frame{
    position:fixed;
    top:0;
    left:0;
    width:100vw;
    height:100vh;
    border:none;
    z-index:0;
    pointer-events:auto; /* Hintergrund interaktiv */
}

/* Fullpage Section für Scroll-Snap */
.section{
    height:100vh;
    width:100vw;
    scroll-snap-align:start;
    position:relative;
    pointer-events:none; /* Section selbst stört Hintergrund nicht */
    display:flex;
    justify-content:flex-end; /* Container unten ausrichten */
    align-items:flex-end;
}

/* TB Container */
.blur-box{
    pointer-events:none; /* Standard: keine Events */
    background: rgba(255,255,255,0.12);
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
    max-height:35vh;
    display:flex;
    flex-direction:row;
    width:100%;
    overflow:hidden;
}

.text-content{
    padding:1rem;
    white-space:pre-wrap;
    color:rgba(255,255,255,0.7);
    font-weight:300;
    font-size:0.95rem;
    overflow-y:auto;
    flex:1;
    scrollbar-width:none;
}
.text-content::-webkit-scrollbar{display:none;}

.image-content{
    width:50vw;
    height:100%;
    overflow:hidden;
    flex-shrink:0;
}
.image-content img{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
}

@media(max-width:767px){
    .blur-box{
        flex-direction:column;
        max-height:50vh;
    }
    .text-content{
        width:100%;
        max-height:30vh;
        margin-bottom:0.5rem;
    }
    .image-content{
        width:100%;
        height:20vh;
    }
}
</style>
</head>
<body>

<iframe id="bg-frame" src="https://paulkimmerl.github.io/tunnel/" allow="autoplay; fullscreen"></iframe>

<div id="container-wrapper"></div>

<script>
// TB Content laden
async function loadContentFromFile(filename){
    try{
        const res = await fetch(filename);
        const contentInput = await res.text();
        const containerWrapper = document.getElementById('container-wrapper');
        containerWrapper.innerHTML = "";

        const containerRegex = /#\d+TB/g;
        let matches,lastIndex=0;
        while((matches=containerRegex.exec(contentInput))!==null){
            const startIndex = matches.index;
            if(lastIndex!==0){
                const text = contentInput.slice(lastIndex,startIndex).trim();
                if(text) createTBSection(text);
            }
            lastIndex = containerRegex.lastIndex;
        }
        const lastText = contentInput.slice(lastIndex).trim();
        if(lastText) createTBSection(lastText);
        enableContainerScroll();
    }catch(e){console.error('Fehler beim Laden von '+filename,e);}
}

function extractMedia(text){
    const imgMatches=[...text.matchAll(/\/\/\s*(.+\.(png|jpg|jpeg|gif|webp))/gi)].map(m=>m[1]);
    return {imgs:imgMatches};
}

function createTBSection(text){
    const section = document.createElement('div');
    section.className = 'section';

    const box = document.createElement('div');
    box.className='blur-box';

    const textDiv = document.createElement('div');
    textDiv.className='text-content';
    textDiv.innerHTML = text.replace(/\*(.*?)\*/g,'<h2>$1</h2>').replace(/\n/g,'<br>');

    const media = extractMedia(text);
    if(media.imgs.length){
        const imgDiv = document.createElement('div'); 
        imgDiv.className='image-content';
        const img = document.createElement('img'); 
        img.src=media.imgs[0]; 
        imgDiv.appendChild(img);
        box.appendChild(textDiv); 
        box.appendChild(imgDiv);
    } else {
        box.appendChild(textDiv);
    }

    section.appendChild(box);
    document.getElementById('container-wrapper').appendChild(section);
}

// Nur Container-Scroll aktiv, Hintergrund bleibt interaktiv
function enableContainerScroll(){
    const boxes = document.querySelectorAll('.blur-box');
    boxes.forEach(box => {
        box.addEventListener('mouseenter', () => {
            box.style.pointerEvents = 'auto';
        });
        box.addEventListener('mouseleave', () => {
            box.style.pointerEvents = 'none';
        });

        box.addEventListener('touchstart', () => {
            box.style.pointerEvents = 'auto';
        });
        box.addEventListener('touchend', () => {
            box.style.pointerEvents = 'none';
        });
    });
}

loadContentFromFile('content.txt');
</script>

</body>
</html>
